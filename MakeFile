# ==========================
# ðŸ§° OpsHub - Makefile
# ==========================

# Variables
PYTHON=python
DOCKER_COMPOSE=docker compose

# --------------------------
# Quality & Tests
# --------------------------
lint:
	ruff check . --fix

format:
	black . --fix

format-check:
	black --check .

test:
	pytest -q

# --------------------------
# Run local server
# --------------------------
run:
	uvicorn app.main:app --reload

# --------------------------
# Docker
# --------------------------
docker-up:
	$(DOCKER_COMPOSE) up --build

docker-down:
	$(DOCKER_COMPOSE) down

# --------------------------
# Database (Alembic)
# --------------------------
migrate:
	alembic revision --autogenerate -m "auto migration"

upgrade:
	alembic upgrade head

# --------------------------
# Meta
# --------------------------
check: lint format-check test

help:
	@echo "ðŸ§° Available commands:"
	@echo "  make lint          â†’ Run Ruff linter"
	@echo "  make format        â†’ Auto-format code with Black"
	@echo "  make format-check  â†’ Check formatting only"
	@echo "  make test          â†’ Run tests with pytest"
	@echo "  make run           â†’ Run FastAPI app locally"
	@echo "  make docker-up     â†’ Build and run with Docker"
	@echo "  make docker-down   â†’ Stop Docker containers"
	@echo "  make migrate       â†’ Create new Alembic migration"
	@echo "  make upgrade       â†’ Apply Alembic migrations"
	@echo "  make check         â†’ Lint + Format-check + Tests"
